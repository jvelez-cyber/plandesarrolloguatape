<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tablero de Compromisos ‚Äì Alcald√≠a de Guatap√©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ECharts -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<!-- Export -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
  --verde:#2fa87a;
  --amarillo:#f5a623;
  --rojo:#d0021b;
  --gris:#f4f6f5;
  --oscuro:#1f2937;
}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--gris);
  color:var(--oscuro);
}

/* HEADER */
header{
  background:white;
  padding:1rem 1.5rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}

header h1{
  margin:0;
  font-size:1.3rem;
}

header small{
  color:#666;
}

.actions button{
  margin-left:.4rem;
  border:none;
  padding:.45rem .7rem;
  border-radius:6px;
  cursor:pointer;
}

.btn-icon{
  background:#eee;
}

.role{
  background:var(--verde);
  color:white;
  padding:.3rem .6rem;
  border-radius:6px;
  font-size:.75rem;
}

/* KPIs */
.kpis{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:1rem;
  padding:1rem;
}

.kpi{
  background:white;
  padding:1rem;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
  cursor:pointer;
  transition:.2s;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.kpi:hover{
  transform:translateY(-4px);
}

.kpi strong{
  font-size:2rem;
}

.kpi.cumplido{border-left:6px solid var(--verde);}
.kpi.riesgo{border-left:6px solid var(--amarillo);}
.kpi.vencido{border-left:6px solid var(--rojo);}

/* CHARTS */
.charts{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:1rem;
  padding:0 1rem;
}

.card{
  background:white;
  border-radius:12px;
  padding:1rem;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}

/* TABLE */
.table-card{
  margin:1rem;
  background:white;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:.7rem;
  border-bottom:1px solid #e5e7eb;
}

th{
  background:#f0f0f0;
  text-align:left;
}

.badge{
  padding:.2rem .6rem;
  border-radius:999px;
  color:white;
  font-size:.75rem;
  font-weight:600;
}

.actions-table button{
  border:none;
  background:none;
  cursor:pointer;
  font-size:1rem;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-content{
  background:white;
  padding:1.5rem;
  border-radius:12px;
  width:350px;
}

.modal-content label{
  display:block;
  margin-top:.7rem;
}

.modal-content input,select{
  width:100%;
  padding:.4rem;
}

.modal-actions{
  margin-top:1rem;
  display:flex;
  justify-content:flex-end;
  gap:.5rem;
}

@media(max-width:900px){
  .kpis{grid-template-columns:repeat(2,1fr);}
  .charts{grid-template-columns:1fr;}
}
</style>
</head>

<body>

<header>
  <div>
    <h1>Tablero de Compromisos</h1>
    <small>Consejo de Gobierno</small>
  </div>
  <div class="actions">
    <button class="btn-icon" onclick="exportExcel()">üìä</button>
    <button class="btn-icon" onclick="exportPDF()">üìÑ</button>
    <span class="role">ADMIN</span>
  </div>
</header>

<section class="kpis">
  <div class="kpi" onclick="filtro(null)">
    <div>Total</div><strong id="kTotal">0</strong>
  </div>
  <div class="kpi cumplido" onclick="filtro('CUMPLIDO')">
    <div>Cumplidos</div><strong id="kCum">0</strong>
  </div>
  <div class="kpi riesgo" onclick="filtro('RIESGO')">
    <div>En riesgo</div><strong id="kRie">0</strong>
  </div>
  <div class="kpi vencido" onclick="filtro('VENCIDO')">
    <div>Vencidos</div><strong id="kVen">0</strong>
  </div>
</section>

<section class="charts">
  <div class="card">
    <h3>Estado de compromisos</h3>
    <div id="chartEstado" style="height:280px"></div>
  </div>
  <div class="card">
    <h3>Compromisos por secretar√≠a</h3>
    <div id="chartSec" style="height:280px"></div>
  </div>
</section>

<div class="table-card">
<table>
<thead>
<tr>
<th>Compromiso</th>
<th>Secretar√≠a</th>
<th>Estado</th>
<th>Avance</th>
<th></th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Editar compromiso</h3>
    <label>Estado</label>
    <select id="mEstado">
      <option value="CUMPLIDO">Cumplido</option>
      <option value="RIESGO">En riesgo</option>
      <option value="VENCIDO">Vencido</option>
    </select>

    <label>Avance</label>
    <input type="number" id="mAvance" min="0" max="100">

    <div class="modal-actions">
      <button onclick="cerrar()">Cancelar</button>
      <button onclick="guardar()">Guardar</button>
    </div>
  </div>
</div>

<script>
/* DATOS DEMO */
let data=[
{d:"Placa huella vereda A",s:"Infraestructura",e:"CUMPLIDO",a:100},
{d:"Mantenimiento v√≠a B",s:"Infraestructura",e:"RIESGO",a:60},
{d:"Dotaci√≥n educativa",s:"Educaci√≥n",e:"VENCIDO",a:30},
{d:"Programa ambiental",s:"Ambiente",e:"CUMPLIDO",a:90}
];

let filtroEstado=null, editIndex=null;

const colores={CUMPLIDO:"#2fa87a",RIESGO:"#f5a623",VENCIDO:"#d0021b"};

function render(){
  const f=data.filter(x=>!filtroEstado||x.e===filtroEstado);
  document.getElementById("tabla").innerHTML=f.map((x,i)=>`
    <tr>
      <td>${x.d}</td>
      <td>${x.s}</td>
      <td><span class="badge" style="background:${colores[x.e]}">${x.e}</span></td>
      <td>${x.a}%</td>
      <td class="actions-table">
        <button onclick="editar(${i})">‚úèÔ∏è</button>
      </td>
    </tr>`).join("");

  document.getElementById("kTotal").textContent=data.length;
  document.getElementById("kCum").textContent=data.filter(x=>x.e==="CUMPLIDO").length;
  document.getElementById("kRie").textContent=data.filter(x=>x.e==="RIESGO").length;
  document.getElementById("kVen").textContent=data.filter(x=>x.e==="VENCIDO").length;

  chartEstado.setOption({
    series:[{type:"pie",radius:["45%","70%"],
      data:Object.keys(colores).map(e=>({
        name:e,value:data.filter(x=>x.e===e).length,
        itemStyle:{color:colores[e]}
      }))
    }]
  });

  const sec={};
  data.forEach(x=>sec[x.s]=(sec[x.s]||0)+1);
  chartSec.setOption({
    xAxis:{type:"category",data:Object.keys(sec)},
    yAxis:{type:"value"},
    series:[{type:"bar",data:Object.values(sec)}]
  });
}

function filtro(e){filtroEstado=e;render();}
function editar(i){
  editIndex=i;
  document.getElementById("mEstado").value=data[i].e;
  document.getElementById("mAvance").value=data[i].a;
  document.getElementById("modal").style.display="flex";
}
function guardar(){
  data[editIndex].e=document.getElementById("mEstado").value;
  data[editIndex].a=document.getElementById("mAvance").value;
  cerrar();render();
}
function cerrar(){document.getElementById("modal").style.display="none";}

function exportExcel(){
  const ws=XLSX.utils.json_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Compromisos");
  XLSX.writeFile(wb,"compromisos.xlsx");
}
function exportPDF(){
  html2pdf().from(document.body).set({filename:"compromisos.pdf"}).save();
}

const chartEstado=echarts.init(document.getElementById("chartEstado"));
const chartSec=echarts.init(document.getElementById("chartSec"));
render();
</script>

</body>
</html>
